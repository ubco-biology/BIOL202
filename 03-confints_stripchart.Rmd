# Confidence intervals on stripcharts {#confint_stripchart}

This page was last updated on `r format(Sys.time(), '%B %d, %Y')`.

* * *

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

This brief demo shows how to add confidence intervals around group means within stripcharts, which are used to visualize a numeric dependent variable (y) in relation to a categorical independent variable (x), as shown in this [tutorial](https://people.ok.ubc.ca/jpither/modules/Visualizing_association_two_variables.html#Visualizing_association_between_a_numeric_and_a_categorical_variable).  

It also calculates some descriptive stats for grouped data, as shown in this [tutorial](https://people.ok.ubc.ca/jpither/modules/Describe_by_group.html).

We use the `penguins` dataset within the `palmerpenguins` package for the demo.  This is a good dataset to use for practicing data wrangling / visualization / stats.

See info about the dataset using this:

```
?palmerpenguins
```

## Session info

Here's some info about R version etc... to help with reproducibility. 

```{r}
sessionInfo()
```

## Libraries

Load libraries.

```{r load_libraries}
library(ggplot2)
library(tidyverse)
library(palmerpenguins)
library(kableExtra)
```

## Summary stats

Let's get summary stats for groups, and present in nice table.

We use the `t.test` function to calculate the appropriate lower and upper 95% confidence limits based on the *t* distribution.

```{r summary_stats, warning = F}
penguin.stats <- penguins %>% 
  group_by(species) %>% 
  summarise(mean.bill.depth = mean(bill_depth_mm, na.rm = T), 
            confint.low.bill.depth = t.test(bill_depth_mm, na.rm = T, 
                                            conf.level = 0.95)$conf.int[1],
            confint.hi.bill.depth = t.test(bill_depth_mm, na.rm = T, 
                                           conf.level = 0.95)$conf.int[2],
            count.bill.depth = sum(!is.na(bill_depth_mm)))
```

Present in table using the `kableExtra` package, as shown in this [tutorial](https://people.ok.ubc.ca/jpither/modules/Comparing_more_than_2_means.html#Descriptive_statistics_by_group).

```{r stats_table}
options(knitr.kable.NA = '') # suppress showing NA values in table
kable(penguin.stats, format = "html", 
      caption = "Table 1: Summary statistics for the penguin species.", 
      digits = c(0, 2, 3, 3, 0), 
      align = "rrrrr") %>%
  kable_styling(position = "left")
```

## Stripchart with CI bars

First need to write function to calculate lower and upper confidence limits, based on `*t*` distribution.  Here we can specify the confidence level one wants to use with the `conf` argument. 

```{r}
# call the lower and upper confidence limits "ymin" and "ymax" respectively
confint.fun.ttest <- function(x, conf = 0.95){
  return(data.frame(Mean = mean(x, na.rm = T),
                    ymin  = t.test(x, conf.level = conf)$conf.int[1],
                    ymax = t.test(x, conf.level = conf)$conf.int[2]))}
```

Now lets create the stripchart , and we'll use the function above in the `stat_summary` function.

We'll create a ggplot object for each step, then show the graph when all pieces are done.

First, the basic stripchart:
```{r stripchart, warning = F}
penguins.stripchart <- penguins %>% 
  ggplot(aes(x = species, y = bill_depth_mm)) +
    geom_jitter(color = "firebrick", size = 3, shape = 1, width = 0.1)
```

Now let's add the confidence interval error bars:
```{r add_bars}
penguins.stripchart.bars <- penguins.stripchart + 
stat_summary(fun.data = confint.fun.ttest, geom = "errorbar", 
                 colour = "black", width = 0.07, 
             position = position_nudge(x = 0.15))
```

Now let's add a point for each group mean:
```{r add_means}
penguins.stripchart.bars.mean <- penguins.stripchart.bars + 
  stat_summary(fun = mean, geom = "point", size = 2, shape = 16, 
               position = position_nudge(x = 0.15)) + 
    labs(x = "Species", y = "Bill depth (mm)") + 
    theme_classic()
```

Now let's see the plot

```{r}
penguins.stripchart.bars.mean
```

voila!
